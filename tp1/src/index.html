<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!--CSS-->
	<link rel="stylesheet" href="vendors/css/bootstrap.min.css">
	<link rel="stylesheet" href="assets/css/main.css">

	<!--JS-->
	<script type="text/javascript" src="vendors/js/jquery-3.2.1.min.js"></script>
	<script type="text/javascript" src="vendors/js/d3.min.js"></script>

</head>
<body>
<div id="main-container">
	<div id="header-container">
		<div class="title">
			<h1>Trabalho Prático 1</h1>
			<span class="author">Higor Hernane</span>
			<span class="author">Thiago Henrique Neves</span>
		</div>

	</div>
	<div id="table-container">
		<div class="table-control">

		</div>
		<table class="table table-striped">
			<thead>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
</div>

<script type="text/javascript"> // INSERIR JAVASCRITP INICIAL AQUI (MAIN)
var datafile = "data/dados_tp1.csv";
var tabledata;
var tableheader;

// Parâmetros padrão das funcionalidades
//paginação
var page = 0;
var rowsPerPage = 20;
// ordenação
var colSort = 0; // índice da coluna que deve ser ordenada
var sortDesc = false; // ordenar crescente
// busca
var keyword = "Watertown";

$(document).ready(function(){
	d3.csv(datafile, function(d){
		tableheader = Object.keys(d[0]);
		tabledata = d;

		d3.selectAll("table").selectAll("thead").append("tr").selectAll("th").data(tableheader).enter().append("th").text(function(c){return c;});

		putTable(tabledata, tableheader);
		sortTable(colSort, sortDesc, tabledata);
		setPagination(page, rowsPerPage);
		//search(keyword);
	});
});

// recebe a matriz que deve ser inserida na tabela
// cada linha é um objeto (por causa do d3)
function putTable(data, columns){
	d3.selectAll("table").selectAll("tbody").selectAll("tr").data(data).enter().append("tr")
	.selectAll('td')
	.data(function (row) {
	return columns.map(
		function (column) {
			return {column: column, value: row[column]};
		});
	})
	.enter()
	.append('td')
	.text(function (d) { return d.value; });
}

// ordena a tabela
// column: id da coluna que será ordenada
// desc: (bool) verdadeiro se for para ordenar em ordem crescente
function sortTable(column, desc, table){
	d3.selectAll("table").selectAll("tbody").selectAll("tr").sort(function(a, b){
		return (desc)?a[tableheader[column]] <= b[tableheader[column]]: b[tableheader[column]] <= a[tableheader[column]];
	})
}

// Configura a paginação de acordo com a pagina e a quantidade de linhas na tabela
function setPagination(newPage, rows){
	page = newPage;
	rowsPerPage = rows;
	var start = newPage*rowsPerPage; // primeira linha a ser exibida
	var end = start + rowsPerPage -1; // o índice começa de zero
	d3.selectAll("table").selectAll("tbody").selectAll("tr")
		.classed("hidden", function(d, i){
			return !(start <= i && i <= end) // verdade se i está fora dos limites
		});
}
/*
function search(kw){
	keyword = kw;
	d3.selectAll("table").selectAll("tbody").selectAll("tr")
		.classed("hidden", keyword && function(d, i){
			found = false;
			for(var k in tableheader){
				if(d[k] === keyword){
					found = true;
				}
			}
			return !found;
		});
}
*/
</script>
</body>

</html>
